<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PlanDaVoyage</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;font-family:'Segoe UI',Tahoma,sans-serif}
body{margin:0;background:#0a0a2a;color:#fff}

.warning{
  background:#c80000;color:#fff;text-align:center;
  padding:10px;font-weight:bold;animation:pulse 2s infinite
}
@keyframes pulse{0%{opacity:1}50%{opacity:.7}100%{opacity:1}}

header{text-align:center;padding:25px}
header h1{color:#8c2cff;font-size:2.8rem}

#stats{text-align:center;font-weight:bold;margin-bottom:10px;color:#0ff}

.search-bar{
  max-width:1200px;margin:auto;padding:0 20px 10px;
  display:flex;gap:10px;flex-wrap:wrap;
}
.search-bar .card{
  background:#11114d;padding:14px 20px;border-radius:12px;
  cursor:pointer;flex:1 1 150px;text-align:center;
  transition:.25s;
}
.search-bar .card.active{background:#5a2cff;color:#fff;font-weight:bold}
.search-bar input{flex:1 1 150px;padding:12px;border-radius:10px;border:1px solid #555;background:#11114d;color:#fff;}

.layout{
  max-width:1200px;margin:auto;
  display:grid;grid-template-columns:320px 1fr;
  gap:20px;padding:20px
}

.list,.details{
  background:#1a1a3d;border-radius:16px;
  box-shadow:0 0 20px rgba(90,44,255,.5)
}

.item{
  padding:16px;border-bottom:1px solid #222;
  cursor:pointer;transition:.25s
}
.item:hover{background:#5a2cff;color:#fff}
.item.active{background:#5a2cff;color:#fff;font-weight:bold}

.details{
  padding:24px;min-height:220px;
  opacity:0;transform:translateY(10px);
  transition:.35s ease
}
.details.show{opacity:1;transform:translateY(0)}

.details h2{color:#8c2cff}
.details button{
  margin-top:15px;padding:12px 18px;
  border:none;border-radius:12px;
  background:#5a2cff;color:#fff;
  font-weight:bold;cursor:pointer
}

#aiBtn{
  position:fixed;bottom:20px;right:20px;
  background:linear-gradient(135deg,#5a2cff,#00b7ff);
  color:#fff;padding:14px 18px;border-radius:30px;
  font-weight:bold;cursor:pointer;
  box-shadow:0 0 20px #5a2cff
}

@media(max-width:900px){
  .layout{grid-template-columns:1fr}
  .search-bar{flex-direction:column}
}
.typing {border-right: .1em solid #fff;white-space:pre-wrap;}
</style>
</head>

<body>

<div class="warning">‚ö†Ô∏è UNDER TESTING & DEVELOPMENT ‚ö†Ô∏è</div>

<header><h1>PlanDaVoyage</h1></header>
<div id="stats">‚≠ê Points: 0</div>

<div class="search-bar">
  <div class="card" id="peopleCard">People</div>
  <div class="card" id="typeCard">Trip Type</div>
  <div class="card" id="countryCard">Country</div>
  <div class="card" id="stateCard">State</div>
  <div class="card" id="cityCard">City</div>
</div>

<div class="layout">
  <div class="list" id="list"></div>
  <div class="details" id="details">
    <p>Select a place to view details.</p>
  </div>
</div>

<div id="aiBtn" onclick="location.href='ai.html'">ü§ñ DaHelpeCenter</div>

<script>
/* RESET SESSION ITINERARY */
sessionStorage.removeItem("itinerary");

/* POINTS */
let user = JSON.parse(localStorage.getItem("pdv_user")) || {points:0};
user.points += 5;
localStorage.setItem("pdv_user",JSON.stringify(user));
document.getElementById("stats").innerText = `‚≠ê Points: ${user.points}`;

/* INPUT STORAGE */
let peopleData = {adults:2, children:[], infants:0};
let tripType = "family";
let locationData = {country:"india", state:"maharashtra", city:"mumbai"};

/* CARD CLICK LOGIC */
function openPrompt(type){
  let val;
  if(type==="people"){
    val = prompt("Enter number of adults:", peopleData.adults);
    peopleData.adults = parseInt(val)||2;
    val = prompt("Enter number of children:", peopleData.children.length);
    let n = parseInt(val)||0;
    peopleData.children = [];
    for(let i=0;i<n;i++){
      let age = prompt(`Enter age of child ${i+1}:`,10);
      peopleData.children.push(parseInt(age)||10);
    }
    val = prompt("Enter number of infants:", peopleData.infants);
    peopleData.infants = parseInt(val)||0;
    document.getElementById("peopleCard").innerText=`${peopleData.adults}ad ${peopleData.children.length}cd ${peopleData.infants}if`;
  }else if(type==="type"){
    val = prompt("Trip type (family/bachelor):",tripType);
    tripType = val.toLowerCase() === "bachelor" ? "bachelor":"family";
    document.getElementById("typeCard").innerText=tripType;
  }else{
    val = prompt(`Enter ${type}:`, locationData[type]);
    locationData[type] = val.toLowerCase();
    document.getElementById(type+"Card").innerText=val;
  }
}

document.getElementById("peopleCard").onclick=()=>openPrompt("people");
document.getElementById("typeCard").onclick=()=>openPrompt("type");
document.getElementById("countryCard").onclick=()=>openPrompt("country");
document.getElementById("stateCard").onclick=()=>openPrompt("state");
document.getElementById("cityCard").onclick=()=>openPrompt("city");

/* GENERATE FINDER CODE */
function generatePeopleCode(adults, childrenAges, infants){
  let code = `${adults}ad${childrenAges.length}cd`;
  if(childrenAges.length>0){
    code+="acdb-";
    childrenAges.forEach((age,i)=>{
      let letter=String.fromCharCode(97+i);
      code+=`cd${letter}${age}`;
    });
  }
  if(infants>0) code+=`if${infants}`;
  return code;
}

function generateFinderCode(){
  const peopleCode = generatePeopleCode(peopleData.adults, peopleData.children, peopleData.infants);
  const typeCode = tripType==="bachelor"?"bach":"family";
  const city = locationData.city;
  const country = locationData.country.slice(0,3);
  return `${peopleCode}.${typeCode}.${city}.${country}`;
}

/* PLACES DATA (ALL ORIGINAL + NEW FIELDS) */
const places=[
{
  name:"Amboli Waterfall",
  description:"Scenic monsoon waterfall in the Western Ghats.",
  info:"3 km from Amboli village. Best June‚ÄìOctober.",
  link:"https://www.google.com/maps/search/?api=1&query=Amboli+Waterfall+Maharashtra",
  city:"amboli",
  state:"maharashtra",
  country:"india",
  vibe:"family",
  minPeople:2,
  maxPeople:10
},
{
  name:"Devkund Waterfall",
  description:"Popular trekking waterfall destination.",
  info:"5 km trek, rocky terrain.",
  link:"https://www.google.com/maps/search/?api=1&query=Devkund+Waterfall+Maharashtra",
  city:"mumbai",
  state:"maharashtra",
  country:"india",
  vibe:"bach",
  minPeople:2,
  maxPeople:6
},
{
  name:"Pawna Dam",
  description:"Reservoir near Lonavala.",
  info:"Popular for camping.",
  link:"https://www.google.com/maps/search/?api=1&query=Pawna+Dam+Maharashtra",
  city:"lonavala",
  state:"maharashtra",
  country:"india",
  vibe:"family",
  minPeople:2,
  maxPeople:10
}
];

/* SMART MATCHING BASED ON FINDER CODE */
function matchPlaces(){
  const code = generateFinderCode();
  const [peoplePart, type, city] = code.split(".");
  const peopleMatch = parseInt(peoplePart.split("ad")[0]);
  return places.filter(p=>p.city===city && ((type==="bach" && p.vibe==="bach") || (type==="family" && p.vibe==="family")) && peopleMatch>=p.minPeople && peopleMatch<=p.maxPeople);
}

/* RENDER LIST */
const list=document.getElementById("list");
const details=document.getElementById("details");

function renderList(){
  const matched = matchPlaces();
  list.innerHTML="";
  matched.forEach(p=>{
    const item=document.createElement("div");
    item.className="item";
    item.textContent=p.name;
    item.onclick=()=>showDetails(p);
    list.appendChild(item);
  });
}

/* TYPING ANIMATION */
function typeText(container,text){
  container.innerHTML="";
  let i=0;
  const interval = setInterval(()=>{
    container.innerHTML=text.slice(0,i+1)+'<span class="typing"></span>';
    i++;
    if(i>=text.length) clearInterval(interval);
  },25);
}

/* SHOW DETAILS */
function showDetails(p){
  details.classList.remove("show");
  setTimeout(()=>{
    const html=`<h2>${p.name}</h2><p>${p.description}</p><p><b>Info:</b> ${p.info}</p><p><a href="${p.link}" target="_blank">View on Google Maps</a></p><button>Add to Itinerary</button>`;
    typeText(details,html);
    details.querySelector("button").onclick=()=>{
      let itin=JSON.parse(sessionStorage.getItem("itinerary"))||[];
      if(itin.some(i=>i.name===p.name)){alert("Already added.");return;}
      itin.push({name:p.name,description:p.description,itineraryInfo:p.info,map:p.link});
      sessionStorage.setItem("itinerary",JSON.stringify(itin));
      user.points+=10;
      localStorage.setItem("pdv_user",JSON.stringify(user));
      document.getElementById("stats").innerText=`‚≠ê Points: ${user.points}`;
    };
    details.classList.add("show");
  },150);
}

renderList();

</script>
</body>
</html>
